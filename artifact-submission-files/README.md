# The VariCity Ecosystem: City Visualization of Object-Oriented Variability in Java and TypeScript
## Artifact Track submission

### Philippe Collet – Johann Mortara –  Yann Brault - Anne-Marie Dery-Pinna

This artifact submission goes with the paper "The VariCity Ecosystem: City Visualization of Object-Oriented Variability in Java and TypeScript" submitted to the SCP special issue on "Tools and Software at the Systems and Software Product Line Conference (SPLC 2022 and 2023)"

## Artifact description

The artifact consists of two archives:

### Current archive

**Accessible at DOI: [TODO](TODO)**


The current archive is organized as follows:
```
.
├── images/
├── INSTALL.md
├── PROJECTS.md
├── LICENSE.md
├── README.md
├── REQUIREMENTS.md
├── varicity-ts.zip
```

- `INSTALL.md`: VariCity-TS and Symfinder-TS installation instructions
- `PROJECTS.md`: Exhaustive list of analyzed projects and metrics
- `LICENSE.md`: license file
- `README.md`: documentation to reproduce the results of the paper and to reuse VariCity-TS on other projects
- `REQUIREMENTS.md`: technical requirements to use VariCity-TS


### VariCity-TS archive

This archive contains:

- the source code of VariCity-TS, the visualization presented in the paper.
VariCity-TS relies on data from Symfinder-TS, whose source code is also present in the artifact archive.
- Symfinder-TS files to analyze the projects studied in the paper.
- the `dockervolume.zip` archive present at the root of the VariCity-TS archive contains data used to generate visualizations for X subject systems studied:
  - pre-generated outputs from the symfinder analyses
  - pre-configured visualizations


## Reproducing the results presented in the paper

### A. Preparing your host system

Set up your host system according to the guidelines given in the `REQUIREMENTS.md` file.

**Note:** your Docker daemon must be running in order to use VariCity-TS.  

### B. Getting the sources

1. Unzip the archive. You should obtain the following hierarchy (only the files useful for the reproduction are shown): _TODO #Update Tree_
```
varicity-TS/
├── build-docker-images.bat
├── build-docker-images.sh
├── data/
│   ├── argouml.yaml
│   ├── azureus.yaml
│   ├── geotools.yaml
│   ├── jdk.yaml
│   ├── jfreechart-1.5.0.yaml
│   ├── jfreechart-refactored.yaml
│   ├── jkube.yaml
│   ├── openapi-generator.yaml
│   ├── spring.yaml
│   └── symfinder.yaml
├── dockervolume.zip
├── run-compose.bat
├── run-compose-detach.sh
└── run-compose.sh
```
In the remaining of this guide, we will refer to `varicity-TS` as the root of the project.
For example, `/dockervolume` represents the `varimetrics_reproduction-package/dockervolume` directory.

### C. Creating the cities with VariCity-TS using the pre-generated visualizations files

The files generated by Symfinder-TS used by VariCity-TS to create the cities for the projects studied, as for example NestJS presented in the paper are available in the `dockervolume.zip` archive.

1. Unzip the `dockervolume.zip` archive to obtain the following hierarchy (only the files useful for the reproduction are shown): _TODO #Update tree_
```
dockervolume/
├── configs/
|   ├── azureus/
|   │   ├── config-azureus-10.yaml
|   │   └── config-azureus-4.yaml
|   ├── geotools/
|   │   ├── config-geotools-14.yaml
|   │   └── config-geotools-5.yaml
|   ├── jdk-17.10/
|   │   ├── config-jdk-17.10-20.yaml
|   │   └── config-jdk-17.10-21.yaml
|   ├── jfreechart-1.5.0/
|   │   ├── config-jfreechart-1.5.0-17.yaml
|   │   ├── config-jfreechart-1.5.0-18.yaml
|   │   ├── config-jfreechart-1.5.0-21.yaml
|   │   ├── config-jfreechart-1.5.0-22.yaml
|   │   ├── config-jfreechart-1.5.0-3.yaml
|   │   └── config-jfreechart-1.5.0-8.yaml
|   ├── jfreechart-refactored/
|   │   ├── config-jfreechart-refactored-20.yaml
|   │   ├── config-jfreechart-refactored-22.yaml
|   │   ├── config-jfreechart-refactored-23.yaml
|   │   └── config-jfreechart-refactored-24.yaml
|   ├── jkube/
|   │   └── config-jkube-9.yaml
|   ├── openapi-generator/
|   │   └── config-openapi-generator-12.yaml
|   └── spring/
|       ├── config-spring-15.yaml
|       └── config-spring-7.yaml
├── data/
│   └── symfinder_files/
│       ├── azuredatastudio.json
│       ├── vscode.json
│       ├── grafana.json
│       ├── angular.json
│       ├── echarts.json
│       ├── nest.json
│       ├── Vim.json
│       ├── parsed
│       │   ├── azuredatastudio.json
│       │   ├── vscode.json
│       │   ├── grafana.json
│       │   ├── angular.json
│       │   ├── echarts.json
│       │   ├── nest.json
│       │   └── Vim.json
└── varicitydb.json
```
The `dockervolume/configs` directory contains the configurations for the views for each project.
The `dockervolume/data` directory contains the symfinder outputs for each project.

2. Run VariCity-TS by running


- On GNU/Linux

    ```
    ./run-compose.sh
    ```
  
For more information on the execution of VariCity-TS, see `INSTALL.md`.

3. Open your web browser and go to [http://localhost:8000](http://localhost:8000)
4. Click on the `Project` dropdown menu. A list of the available projects appears.
![project_selection_panel](TODO)
5. By clicking on the desired project's name here Nest, a pre-configured view appears in the background. You can choose the view you want by clicking on the second dropdown menu.
![view_selection_panel](TODO)
6. The `dockervolume/configs` directory contains a directory for each project, containing several pre-configured views. The Nest configuration matching the view presented in the paper as `Figure 4b` is labeled under `Varicity view - Figure 2`.
7. By clicking on the view `Varicity view - Figure 2`, the city is loaded.
![Nest_visualization](TODO)
-The visualization above shows Nest with usage orientation set to OUT and usage level set to 2.

>Please note that the visualization may not be centered when appearing. The rendering time of the visualization increases with the number of buildings to display.
>To limit the loading time when switching between projects, we advise to reduce the value of the usage level to limit the number of buildings to render before switching.

### D. Generating the visualizations files with Symfinder-TS

The Varicity-TS artifact contains in the `/Dockervolume/data` directory the configurations for system studied. _TODO #Update projects_
- `azuredatastudio.json` → [Azure Data Studio](https://github.com/microsoft/azuredatastudio)
- `vscode.json` → [VSCode](https://github.com/microsoft/vscode)
- `grafana.json` → [Grafana](https://github.com/grafana/grafana)
- `angular.json` → [Angular](https://github.com/angular/angular)
- `echarts.json` → [Echarts](https://github.com/apache/echarts)
- `nest.json` → [Nest](https://github.com/nestjs/nest)
- `Vim.json` → [Vim](https://github.com/VSCodeVim/Vim)

To generate the visualization files for a project, go to the root of the project and run Symfinder-TS as detailed in the "Running a Symfinder-TS analysis" section of the `INSTALL.md` file.

*Notes:* Some analyses, such as Azure Data Studio, VS Code, Grafana or Angular can take multiple hours.
We advise, for a quick evaluation of the toolchain's capabilities, to analyse smaller projects (e.g. Echarts, Nest or Vim).

## Reusing VariCity-TS and Symfinder-TS on other projects

To analyse a project, you will need to:
- Have a web URL of your GitHub repository. Be careful to use the web page link and **NOT** the HTTPS clone link.

Hereafter we will detail the steps to configure a view on one of these systems, [Echarts](https://github.com/apache/echarts).

Let's execute symfinder on Echarts.

- In one terminal

```
./run-compose.sh
```

- In another terminal
```shell
./run-docker-cli.sh https://github.com/apache/echarts -http
```

After the execution of the symfinder analysis, go on `http://localhost:8000` and select the `Echarts` project. _TODO #Update example_

![nekohtml_selection](images/nekohtml_selection.png)

A unique view configuration is available, called `default config`, showing an empty visualization.

Close the popup. On the sidebar, click on the `APIs and Blacklist` button.

![nekohtml_apis_panel](images/nekohtml_APIs_panel.png)

In the `API classes` field, start typing `HTMLScanner`, and select `org.codelibs.nekohtml.HTMLScanner`.

![nekohtml_apis_panel_htmlscanner](images/nekohtml_APIs_panel_HTMLScanner.png)

Press Enter, a visualization should appear.

![nekohtml_htmlscanner_out_2](images/nekohtml_HTMLScanner_OUT_2.png)

This visualization is the standard VariCity one.

By clicking on this class, the `Information` panel opens to give us information about it.

![nekohtml_writer](images/nekohtml_Writer.png)

This class is [`org.codelibs.nekohtml.filters.Writer`](https://github.com/Corpus-2021/nekohtml/blob/2.1.1-AnalysisReady/src/main/java/org/codelibs/nekohtml/filters/Writer.java), whose goal is to print an HTML content to an output stream.
The three constructors allow to write on different outputs (standard output, Java `OutputStream` or Java `Writer`), therefore exhibiting variability.
The class is not covered (coverage of 0%) despite having a relatively high cognitive complexity of 76.

## Detailed README

A more exhaustive documentation on
- the capabilities of the VariCity-TS visualization
- the configuration of a Symfinder-TS analysis
- the technical organization of the toolchain
is available in the `README.md` file at the root of the varicity-TS archive, that itself points to other documentations.
